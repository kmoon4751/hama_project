<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>편의시설</title>

    <!--아이콘-->
    <script src="https://kit.fontawesome.com/ba16334cfd.js" crossorigin="anonymous"></script>
    

    <link rel="stylesheet" href="./header.css">
    <link rel="stylesheet" href="./footer_color.css">
    <link rel="stylesheet" href="./footer_style.css">
    <link rel="stylesheet" href="./btn.css">
    <link rel="stylesheet" href="./font.css">
    <link rel="stylesheet" href="./convenient__facilities.css">


    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=943f1df4507ed8b8301aba42e152caae&libraries=services,clusterer,drawing"
    ></script>
    <script
      type="text/javascript"
      src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=ps74d8pox5"
    ></script>


    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=943f1df4507ed8b8301aba42e152caae&libraries=services"></script>

    <style>


        </style>

</head>

<body>
    <!--편의시설 전체(헤더+메인+푸터)박스-->
    <div class="convenient__facilities">

        <!-- 헤더 시작 -->
        <div class="header">
            <div class="headers">
            <div class="logo_loggo">
    
         <!-- logo / 로고 -->
         <div class="logo"
            onclick="location.href='http://192.168.0.182:5500/project/index/index.html'"
            style="cursor: pointer;"><img src="./img/logo.png" width="140px" height="70px"></div>
         </div>
    
         <!-- 로고 옆 gnb 커뮤니티,채팅 등등 -->            
         <div class="gnb">
            <ul class="menu__headers">

             <!-- 일을주마 -->
                <li>
                   <a href="#">일을주마</a>
                   <ul class="depth_1">
                       <li><a href="#">견적요청</a></li>
                   </ul>
                </li>

              <!-- 일을하마 -->
                <li>
                   <a href="#">일을하마</a>
                   <ul class="depth_1">
                       <li><a href="#">요청게시판</a></li>
                   </ul>
                </li>
             <!-- 커뮤니티 -->
                <li>
                  <a href="#">커뮤니티</a>
                </li>
             <!-- 하마찾기 -->
                <li>
                  <a href="#">하마찾기</a>
                </li>
            </ul>
        </div>
    
        <!-- 로그인,회원가입  -->
        <div class="login_signup">
            <div></div>
            <div class="login" onclick="location.href='http://192.168.0.182:5500/project/login/login.html'"style="cursor: pointer;">받은요청</div>
            <div class="login" onclick="location.href='http://192.168.0.182:5500/project/login/signup.html'"style="cursor: pointer;">보낸견적</div>
            <div class="login" onclick="location.href='http://192.168.0.182:5500/project/login/signup.html'"style="cursor: pointer;">채팅</div>
            <div class="login2"style="cursor: pointer;">
                <li>
                    <a href="#"><i class="fa-solid fa-user"></i></i></a>
                    <ul class="depth_1">
                        <li><p>회원관리</p></li>
                        <li><a href="#">하마신청</a></li>
                        <li><a href="#">프로필등록</a></li> 
                        <li><a href="#">회원정보수정</a></li>
                        <li><a href="#">회원탈퇴</a></li>
                        <li><p>하마전용</p></li>
                        <li><a href="#">포트폴리오</a></li>
                    </ul>
                 </li></div>
            
            </div>
        </div>
        </div>

        <!-- main 박스 -->
        <div class="convenient__facilities__main">

            <div class="map_wrap">
                <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
            
                <div id="menu_wrap" class="bg_white">
                    <div class="option">
                        <div>
                            <form onsubmit="searchPlaces(); return false;">
                                주소 : <input type="text" value="편의점" id="keyword" size="15"> 
                                <button type="submit">검색하기</button> 
                            </form>
                        </div>
                    </div>
                    <hr>
                    <ul id="placesList"></ul>
                    <div id="pagination"></div>
                </div>
            </div> 

        </div>

        <!-- 푸터시작 -->
        <div class="footer">
            <div class="f1"></div>
            <div class="f2"></div>
           
            <!--푸터 바디-->
            <div class="footer__body">
    
                <!--이용약관 개인정보처리방침 자주묻는질문 공지사항 광고문의-->
                    <div class = "menu__footer">
                        <p><a href="#">이용약관</a></p>
                        <p><a href="#">개인정보처리방침</a></p>
                        <p><a href="#">자주 묻는 질문</a></p>
                        <p><a href="#">공지사항</a></p>
                        <p><a href="#">광고문의</a></p>
                    </div>
                
    
                <!--푸터 바디 속 컨텐츠 시작-->
                <div class="footer__content">
                    
                    <!--박스1-->
                    <div class="footer__content3">
                        <p class="title">사업자 등록번호 : 111-77-123456</p>
                        <p>우아한하마들(주) 대표팀장 정인수</p>
                        <p>개인정보관리책임자:정인수</p>
                    </div>
    
                    <!--박스2-->
                    <div class="footer__content4">
                        <p>평일:오전 10:00 ~ 오후 18:00</p>
                        <p>점심:오후 12:00 ~ 오후 13:00</p>
                        <p>토/일/공휴일 휴무</p>
                        <p>TEL : 123-456-7890</p>
                    </div>
                    
                </div><!--푸터 바디 속 컨텐츠 끝-->
    
                <!--카피라이트-->
                <div class="footer__copyright">
                    COPYRIGHT ⓒ 우아한하마들(주) COMPANY. ALL RIGHTS RESERVED.
                </div>
    
             </div>
        </div>   
        
    </div>

    <!-- 지도 자바 -->
    <script>

    
const $keyword = document.getElementById('keyword');

//이벤트 핸들러 추가
const h_search = ({key, target}) => {
    // 입력된 키가 'Enter'가 아니라면 동작하지 않음
    if(key !== 'Enter') return;
    const keyword = target.value;

    // 장소 검색 객체를 생성
    const ps = new kakao.maps.services.Places();

    // 키워드로 장소를 검색
    ps.keywordSearch(keyword,placesSearchCB,{ category_group_code: 'CS2' });
}

$keyword.addEventListener('keyup', h_search);


// 마커를 담을 배열입니다
var markers = [];

var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
mapOption = {
    center: new kakao.maps.LatLng(35.535066, 129.310928), // 지도의 중심좌표
    level: 3 // 지도의 확대 레벨
};  

// 지도를 생성합니다    
var map = new kakao.maps.Map(mapContainer, mapOption); 

// 장소 검색 객체를 생성합니다
var ps = new kakao.maps.services.Places();  

// 검색 결과 목록이나 마커를 클릭했을 때 장소명을 표출할 인포윈도우를 생성합니다
var infowindow = new kakao.maps.InfoWindow({zIndex:1});

// 키워드로 장소를 검색합니다
searchPlaces(); 

// 키워드 검색을 요청하는 함수입니다
function searchPlaces() {

var keyword = document.getElementById('keyword').value;

if (!keyword.replace(/^\s+|\s+$/g, '')) {
    alert('알아보고자 하는 주소를 입력해주세요.');
    return false;
}   

// 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
ps.keywordSearch(keyword, placesSearchCB,{ category_group_code: 'CS2' }); 
}

// 장소검색이 완료됐을 때 호출되는 콜백함수 입니다
function placesSearchCB(data, status, pagination) {
    if (status === kakao.maps.services.Status.OK) {

        // 정상적으로 검색이 완료됐으면
        // 검색 목록과 마커를 표출합니다
        displayPlaces(data);

        // 페이지 번호를 표출합니다
        displayPagination(pagination);

    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

        alert('해당 편의점이 존재하지 않습니다.');
        return;

    } else if (status === kakao.maps.services.Status.ERROR) {

        alert('검색 결과 중 오류가 발생했습니다.');
        return;

    }
}


// 검색 결과 목록과 마커를 표출하는 함수입니다
function displayPlaces(places) {

var listEl = document.getElementById('placesList'), 
menuEl = document.getElementById('menu_wrap'),
fragment = document.createDocumentFragment(), 
bounds = new kakao.maps.LatLngBounds(), 
listStr = '';

// 검색 결과 목록에 추가된 항목들을 제거합니다
removeAllChildNods(listEl);

// 지도에 표시되고 있는 마커를 제거합니다
removeMarker();

for ( var i=0; i<places.length; i++ ) {

    // 마커를 생성하고 지도에 표시합니다
    var placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
        marker = addMarker(placePosition, i), 
        itemEl = getListItem(i, places[i]); // 검색 결과 항목 Element를 생성합니다

    // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
    // LatLngBounds 객체에 좌표를 추가합니다
    bounds.extend(placePosition);

    // 마커와 검색결과 항목에 mouseover 했을때
    // 해당 장소에 인포윈도우에 장소명을 표시합니다
    // mouseout 했을 때는 인포윈도우를 닫습니다
    (function(marker, title) {
        kakao.maps.event.addListener(marker, 'mouseover', function() {
            displayInfowindow(marker, title);
        });

        kakao.maps.event.addListener(marker, 'mouseout', function() {
            infowindow.close();
        });

        itemEl.onmouseover =  function () {
            displayInfowindow(marker, title);
        };

        itemEl.onmouseout =  function () {
            infowindow.close();
        };
    })(marker, places[i].place_name);

    fragment.appendChild(itemEl);
}

// 검색결과 항목들을 검색결과 목록 Element에 추가합니다
listEl.appendChild(fragment);
menuEl.scrollTop = 0;

// 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
map.setBounds(bounds);
}

// 검색결과 항목을 Element로 반환하는 함수입니다
function getListItem(index, places) {

var el = document.createElement('li'),
itemStr = '<span class="markerbg marker_' + (index+1) + '"></span>' +
            '<div class="info">' +
            '   <h5>' + places.place_name + '</h5>';

if (places.road_address_name) {
    itemStr += '    <span>' + places.road_address_name + '</span>' +
                '   <span class="jibun gray">' +  places.address_name  + '</span>';
} else {
    itemStr += '    <span>' +  places.address_name  + '</span>'; 
}
            
itemStr += '  <span class="tel">' + places.phone  + '</span>' +
            '</div>';           

el.innerHTML = itemStr;
el.className = 'item';

return el;
}

// 마커를 생성하고 지도 위에 마커를 표시하는 함수
function addMarker(position, idx, title) {
var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // 마커 이미지 url, 스프라이트 이미지 사용
    imageSize = new kakao.maps.Size(36, 37),  // 마커 이미지의 크기
    imgOptions =  {
        spriteSize : new kakao.maps.Size(36, 691), // 스프라이트 이미지의 크기
        spriteOrigin : new kakao.maps.Point(0, (idx*46)+10), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
        offset: new kakao.maps.Point(13, 37) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
    },
    markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
        marker = new kakao.maps.Marker({
        position: position, // 마커의 위치
        image: markerImage 
    });

marker.setMap(map); // 지도 위에 마커를 표출합니다
markers.push(marker);  // 배열에 생성된 마커를 추가합니다

return marker;
}

// 지도 위에 표시되고 있는 마커를 모두 제거합니다
function removeMarker() {
for ( var i = 0; i < markers.length; i++ ) {
    markers[i].setMap(null);
}   
markers = [];
}

// 검색결과 목록 하단에 페이지번호를 표시는 함수입니다
function displayPagination(pagination) {
var paginationEl = document.getElementById('pagination'),
    fragment = document.createDocumentFragment(),
    i; 

// 기존에 추가된 페이지번호를 삭제
while (paginationEl.hasChildNodes()) {
    paginationEl.removeChild (paginationEl.lastChild);
}

for (i=1; i<=pagination.last; i++) {
    var el = document.createElement('a');
    el.href = "#";
    el.innerHTML = i;

    if (i===pagination.current) {
        el.className = 'on';
    } else {
        el.onclick = (function(i) {
            return function() {
                pagination.gotoPage(i);
            }
        })(i);
    }

    fragment.appendChild(el);
}
paginationEl.appendChild(fragment);
}

// 검색결과 목록 또는 마커를 클릭했을 때 호출되는 함수입니다
// 인포윈도우에 장소명을 표시합니다
function displayInfowindow(marker, title) {
var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

infowindow.setContent(content);
infowindow.open(map, marker);
}

// 검색결과 목록의 자식 Element를 제거하는 함수입니다
function removeAllChildNods(el) {   
while (el.hasChildNodes()) {
    el.removeChild (el.lastChild);
}
}

    </script>
        
</body>
        
</html>
    